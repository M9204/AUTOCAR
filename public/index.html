<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Relay Control</title>
<style>
  button { padding: 1em; margin: 0.5em; font-size: 1.2em; }
</style>
</head>
<body>
  <h1>Relay Control Panel</h1>
  <div id="buttons">
    <button onclick="toggleRelay(22)" id="btn22">Relay 22: ON</button>
    <button onclick="toggleRelay(23)" id="btn23">Relay 23: ON</button>
    <button onclick="toggleRelay(24)" id="btn24">Relay 24: ON</button>
    <button onclick="toggleRelay(25)" id="btn25">Relay 25: ON</button>
  </div>

  <script>
    const relays = [22, 23, 24, 25];
    const baseURL = "https://autocar-gtpk.onrender.com";

    async function fetchStates() {
      try {
        const res = await fetch(`${baseURL}/api/relays`);
        const data = await res.json();
        relays.forEach(pin => {
          const btn = document.getElementById('btn' + pin);
          btn.textContent = `Relay ${pin}: ${data[pin] ? "ON" : "OFF"}`;
        });
      } catch(e) {
        console.error('Failed to fetch relay states', e);
      }
    }
    
    async function toggleRelay(pin) {
      try {
        await fetch(`${baseURL}/api/relays/${pin}`, {
          method: 'POST'
        });
        await fetchStates(); // Update buttons
      } catch(e) {
        alert('Failed to toggle relay');
      }
    }

    // Refresh every 2 seconds
    setInterval(fetchStates, 2000);
    fetchStates();
  </script>
</body>
</html>
