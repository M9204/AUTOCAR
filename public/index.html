<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>ESP32 Car Control</title>
  <script src="https://unpkg.com/paho-mqtt/mqttws31.min.js"></script>
</head>

<body style="font-family: Arial; text-align: center; margin-top: 40px;">
  <h2>ğŸš— ESP32 Car Control Panel</h2>

  <button onclick="connect()">ğŸ”Œ Connect</button>
  <p id="status">Disconnected</p>

  <hr>

  <h3>Engine</h3>
  <button onclick="publish('car/start','start')">â–¶ï¸ Start Car</button>
  <button onclick="publish('car/start','stop')">â¹ Stop Car</button>

  <hr>

  <h3>Doors</h3>
  <button onclick="publish('car/door/lock','on')">ğŸ”’ Lock</button>
  <button onclick="publish('car/door/unlock','on')">ğŸ”“ Unlock</button>

  <hr>

  <h3>Manual Relays</h3>
  <button onclick="publish('car/relay/0','on')">ACC ON</button>
  <button onclick="publish('car/relay/0','off')">ACC OFF</button><br><br>

  <button onclick="publish('car/relay/1','on')">IGN1 ON</button>
  <button onclick="publish('car/relay/1','off')">IGN1 OFF</button><br><br>

  <button onclick="publish('car/relay/2','on')">IGN2 ON</button>
  <button onclick="publish('car/relay/2','off')">IGN2 OFF</button><br><br>

  <button onclick="publish('car/relay/3','on')">START ON</button>
  <button onclick="publish('car/relay/3','off')">START OFF</button>

  <script>
    const BROKER = "wss://ddf927fd9af44789b245774345c7bf14.s1.eu.hivemq.cloud:8884/mqtt";
    const USERNAME = "user9";
    const PASSWORD = "hknnQlRofqnyqj_aQxmeoJ6vPbvK-4fX";

    let client;

    function connect() {
      const clientId = "web-" + Math.random().toString(16).substr(2, 8);
      client = new Paho.MQTT.Client(BROKER, clientId);

      client.onConnectionLost = () => {
        document.getElementById("status").innerText = "âŒ Disconnected";
      };

      client.connect({
        useSSL: true,
        userName: USERNAME,
        password: PASSWORD,
        onSuccess: () => {
          document.getElementById("status").innerText = "âœ… Connected";
          client.subscribe("car/#");
        },
        onFailure: (err) => {
          alert("Connection failed");
          console.error(err);
        }
      });
    }

    function publish(topic, payload) {
      if (!client || !client.isConnected()) {
        alert("Not connected!");
        return;
      }
      const msg = new Paho.MQTT.Message(payload);
      msg.destinationName = topic;
      client.send(msg);
      console.log("Sent:", topic, payload);
    }
  </script>
</body>
</html>
