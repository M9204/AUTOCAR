<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>AutoCar Relay Control</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
    .relay { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 5px; }
    .on { background-color: #c8f7c5; }
    .off { background-color: #f7c5c5; }
  </style>
</head>
<body>
  <h1>AutoCar Relay Status</h1>
  <div id="relays">
    <div id="relay0" class="relay">Relay 0: <span class="state">Loading...</span></div>
    <div id="relay1" class="relay">Relay 1: <span class="state">Loading...</span></div>
    <div id="relay2" class="relay">Relay 2: <span class="state">Loading...</span></div>
    <div id="relay3" class="relay">Relay 3: <span class="state">Loading...</span></div>
  </div>

  <script>
    async function fetchRelayState() {
      try {
        const response = await fetch('relay_state.json', {cache: "no-store"});
        if (!response.ok) throw new Error('Network response was not ok');

        const data = await response.json();

        for (let i = 0; i < 4; i++) {
          const relayDiv = document.getElementById('relay' + i);
          const state = data['relay' + i];
          if (state) {
            relayDiv.querySelector('.state').textContent = state.toUpperCase();
            relayDiv.className = 'relay ' + (state === 'on' ? 'on' : 'off');
          } else {
            relayDiv.querySelector('.state').textContent = 'N/A';
            relayDiv.className = 'relay off';
          }
        }
      } catch (error) {
        console.error('Failed to fetch relay states:', error);
        for (let i = 0; i < 4; i++) {
          const relayDiv = document.getElementById('relay' + i);
          relayDiv.querySelector('.state').textContent = 'Error';
          relayDiv.className = 'relay off';
        }
      }
    }

    // Fetch once immediately
    fetchRelayState();

    // Refresh every 10 seconds
    setInterval(fetchRelayState, 10000);
  </script>
</body>
</html>
